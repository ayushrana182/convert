{{ 'component-card.css' | asset_url | stylesheet_tag }}

<div class="page-width">
  <div class="lookbook-section">
    {% if section.settings.title %}
      <h2 class="lookbook-section__title">{{ section.settings.title }}</h2>
    {% endif %}
    
    <div class="lookbook-collection">
      {% if section.settings.selected_lookbook != blank %}
        {% comment %} Show only selected lookbook {% endcomment %}
        {% assign target_lookbook = section.settings.selected_lookbook %}
        {% assign found_lookbook = false %}
        {% for lookbook in shop.metaobjects.lookbook.values %}
          {% if lookbook.title.value == target_lookbook %}
            {% assign found_lookbook = true %}
            <div class="lookbook-item">
              <h2 class="lookbook-item__title">{{ lookbook.title.value }}</h2>
              
              {% if lookbook.image.value %}
                <div class="lookbook-item__image">
                  <img
                    src="{{ lookbook.image.value | image_url: width: 800 }}"
                    alt="{{ lookbook.title.value | escape }}"
                    loading="lazy"
                    width="800"
                    height="600"
                  >    
                </div>
              {% endif %}
              
              {% if lookbook.description.value %}
                <div class="lookbook-item__description">
                  {% comment %} Parse rich text description {% endcomment %}
                  {% assign desc_data = lookbook.description.value %}
                  {% if desc_data.children %}
                    {% for paragraph in desc_data.children %}
                      {% if paragraph.type == "paragraph" %}
                        <p>
                          {% for text in paragraph.children %}
                            {{ text.value }}
                          {% endfor %}
                        </p>
                      {% endif %}
                    {% endfor %}
                  {% else %}
                    {{ lookbook.description.value }}
                  {% endif %}
                </div>
              {% endif %}
              
              <div class="lookbook-products">
                {% for product in lookbook.products.value %}
                  <div class="lookbook-product">
                    <a href="{{ product.url }}" class="lookbook-product__link">
                      <div class="lookbook-product__image">
                        {% if product.featured_image %}
                          <img
                            src="{{ product.featured_image | image_url: width: 400 }}"
                            alt="{{ product.title | escape }}"
                            loading="lazy"
                            width="400"
                            height="400"
                          >
                        {% else %}
                          {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                        {% endif %}
                      </div>
                      <div class="lookbook-product__info">
                        <h4 class="lookbook-product__title">{{ product.title }}</h4>
                        <p class="lookbook-product__price">{{ product.price | money }}</p>
                      </div>
                    </a>
                  </div>
                {% endfor %}
              </div>
            </div>
            {% break %}
          {% endif %}
        {% endfor %}
        
        {% unless found_lookbook %}
          <div class="lookbook-empty">
            <p>Selected lookbook not found.</p>
          </div>
        {% endunless %}
      {% else %}
        {% comment %} Show all lookbooks {% endcomment %}
        {% for lookbook in shop.metaobjects.lookbook.values %}
          <div class="lookbook-item">
            <h2 class="lookbook-item__title">{{ lookbook.title.value }}</h2>
            
            {% if lookbook.image.value %}
              <div class="lookbook-item__image">
                <img
                  src="{{ lookbook.image.value | image_url: width: 800 }}"
                  alt="{{ lookbook.title.value | escape }}"
                  loading="lazy"
                  width="800"
                  height="600"
                >    
              </div>
            {% endif %}
            
            {% if lookbook.description.value %}
              <div class="lookbook-item__description">
                {% comment %} Parse rich text description {% endcomment %}
                {% assign desc_data = lookbook.description.value %}
                {% if desc_data.children %}
                  {% for paragraph in desc_data.children %}
                    {% if paragraph.type == "paragraph" %}
                      <p>
                        {% for text in paragraph.children %}
                          {{ text.value }}
                        {% endfor %}
                      </p>
                    {% endif %}
                  {% endfor %}
                {% else %}
                  {{ lookbook.description.value }}
                {% endif %}
              </div>
            {% endif %}
            
            <div class="lookbook-products">
              {% for product in lookbook.products.value %}
                <div class="lookbook-product">
                  <a href="{{ product.url }}" class="lookbook-product__link">
                    <div class="lookbook-product__image">
                      {% if product.featured_image %}
                        <img
                          src="{{ product.featured_image | image_url: width: 400 }}"
                          alt="{{ product.title | escape }}"
                          loading="lazy"
                          width="400"
                          height="400"
                        >
                      {% else %}
                        {{ 'product-1' | placeholder_svg_tag: 'placeholder-svg' }}
                      {% endif %}
                    </div>
                    <div class="lookbook-product__info">
                      <h4 class="lookbook-product__title">{{ product.title }}</h4>
                      <p class="lookbook-product__price">{{ product.price | money }}</p>
                    </div>
                  </a>
                </div>
              {% endfor %}
            </div>
          </div>
        {% else %}
          <div class="lookbook-empty">
            <p>No lookbooks found. Please create lookbook metaobjects in your Shopify admin.</p>
          </div>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</div>

<style>
  .lookbook-section {
    margin: 40px 0;
  }
  
  .lookbook-section__title {
    margin-bottom: 30px;
    text-align: center;
    font-size: 32px;
    font-weight: 600;
  }
  
  .lookbook-item {
    margin-bottom: 60px;
  }
  
  .lookbook-item__title {
    font-size: 28px;
    margin-bottom: 20px;
    text-align: center;
    font-weight: 500;
  }
  
  .lookbook-item__image {
    margin-bottom: 30px;
    text-align: center;
  }
  
  .lookbook-item__image img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
  }
  
  .lookbook-item__description {
    font-size: 16px;
    line-height: 1.6;
    margin: 0 auto 30px;
    max-width: 800px;
    text-align: center;
  }
  
  .lookbook-products {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 40px;
  }
  
  .lookbook-product {
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
  }
  
  .lookbook-product:hover {
    transform: translateY(-2px);
  }
  
  .lookbook-product__link {
    display: block;
    text-decoration: none;
    color: inherit;
    height: 100%;
  }
  
  .lookbook-product__image {
    position: relative;
    width: 100%;
    padding-top: 100%;
    overflow: hidden;
    background-color: #f8f8f8;
  }
  
  .lookbook-product__image img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .lookbook-product__info {
    padding: 15px;
  }
  
  .lookbook-product__title {
    margin: 0 0 8px;
    font-size: 14px;
    font-weight: 500;
    line-height: 1.3;
  }
  
  .lookbook-product__price {
    margin: 0;
    font-weight: 600;
    color: #333;
  }
  
  .lookbook-empty {
    text-align: center;
    padding: 40px;
    background: #f7f7f7;
    border-radius: 8px;
  }
  
  @media screen and (max-width: 990px) {
    .lookbook-products {
      grid-template-columns: repeat(3, 1fr);
    }
  }
  
  @media screen and (max-width: 749px) {
    .lookbook-products {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .lookbook-item__title {
      font-size: 24px;
    }
  }
</style>

{% schema %}
{
  "name": "Lookbook",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section title",
      "default": "Our Lookbooks"
    },
    {
      "type": "select",
      "id": "selected_lookbook",
      "label": "Select Lookbook",
      "options": [
        {
          "value": "",
          "label": "Show all lookbooks"
        },
        {
          "value": "Autumn Sale",
          "label": "Autumn Sale"
        },
        {
          "value": "Spring Sale",
          "label": "Spring Sale"
        },
        {
          "value": "Summer Sale",
          "label": "Summer Sale"
        },
        {
          "value": "Winter Sale",
          "label": "Winter Sale"
        }
      ],
      "default": ""
    }
  ],
  "presets": [
    {
      "name": "Lookbooks",
      "category": "Custom Content"
    }
  ]
}
{% endschema %}